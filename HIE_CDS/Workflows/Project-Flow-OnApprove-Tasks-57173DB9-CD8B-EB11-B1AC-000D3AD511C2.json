{"properties":{"connectionReferences":{"shared_commondataserviceforapps_1":{"runtimeSource":"embedded","connection":{"connectionReferenceLogicalName":"leidos_ConnProject"},"api":{"name":"shared_commondataserviceforapps"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"When_a_row_is_added,_modified_or_deleted":{"type":"OpenApiConnectionWebhook","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"SubscribeWebhookTrigger","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"subscriptionRequest/message":3,"subscriptionRequest/entityname":"leidos_project","subscriptionRequest/scope":4,"subscriptionRequest/filteringattributes":"statuscode","subscriptionRequest/filterexpression":"(statuscode eq 445260001)","subscriptionRequest/runas":3},"authentication":"@parameters('$authentication')"}}},"actions":{"Perform_a_bound_action":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"PerformBoundAction","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","actionName":"Microsoft.Dynamics.CRM.leidos_ProjectActionCallGenerateTransactionProcesssGenie","recordId":"@triggerOutputs()?['body/leidos_projectid']"},"authentication":"@parameters('$authentication')"}},"List_rows_of_Agreed_loans_on_Project":{"runAfter":{"Perform_a_bound_action":["Succeeded","Failed","Skipped","TimedOut"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_loans","fetchXml":"<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\" >\n  <entity name=\"leidos_loan\" >\n    <attribute name=\"leidos_loanid\" />\n    <filter type=\"and\" >\n      <condition attribute=\"statuscode\" operator=\"eq\" value=\"100000001\" />\n    </filter>\n    <link-entity name=\"leidos_projectfunding\" from=\"leidos_projectfundingid\" to=\"leidos_parentfunding\" link-type=\"inner\" alias=\"a_c2f18ff41f1deb11a8130022483fae82\" >\n      <attribute name=\"leidos_parentproject\" />\n      <link-entity name=\"leidos_projectcost\" from=\"leidos_projectcostid\" to=\"leidos_parentprojectcost\" link-type=\"inner\" alias=\"ak\" >\n        <link-entity name=\"leidos_project\" from=\"leidos_projectid\" to=\"leidos_parentproject\" link-type=\"inner\" alias=\"al\" >\n          <filter type=\"and\" >\n            <condition attribute=\"leidos_projectid\" operator=\"eq\" value=\"@{triggerOutputs()?['body/leidos_projectid']}\" />\n          </filter>\n        </link-entity>\n      </link-entity>\n    </link-entity>\n  </entity>\n</fetch>"},"authentication":"@parameters('$authentication')"},"description":"Set to Run After for any outcome to ensure it runs"},"Number_of_Loans":{"runAfter":{"List_rows_of_Agreed_loans_on_Project":["Succeeded"]},"type":"Compose","inputs":"@length(outputs('List_rows_of_Agreed_loans_on_Project')?['body/value'])"},"Get_Loan_ID":{"runAfter":{"Number_of_Loans":["Succeeded"]},"type":"Compose","inputs":"@First(outputs('List_rows_of_Agreed_loans_on_Project')?['body/value'])?['leidos_loanid']"},"Update_Loan_Status_to_Approved":{"runAfter":{"Get_Loan_ID":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_loans","recordId":"@outputs('Get_Loan_ID')","item/statecode":0,"item/statuscode":100000012},"authentication":"@parameters('$authentication')"}}},"outputs":{}}},"schemaVersion":"1.0.0.0"}