{"properties":{"connectionReferences":{"shared_commondataserviceforapps":{"runtimeSource":"embedded","connection":{},"api":{"name":"shared_commondataserviceforapps"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"Recurrence":{"recurrence":{"frequency":"Week","interval":1,"schedule":{"weekDays":["Monday"],"hours":["8"]}},"type":"Recurrence"}},"actions":{"List_Approved_AMR_Records_Due_Last_30_Days":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_accountmanagementrecords","$filter":"Microsoft.Dynamics.CRM.LastXDays(PropertyName='leidos_businessreviewreminderdate',PropertyValue=30) and statuscode eq 445260000"},"authentication":"@parameters('$authentication')"}},"Loop_Thru_open_AMR_and_Create_Reminder_Task":{"foreach":"@outputs('List_Approved_AMR_Records_Due_Last_30_Days')?['body/value']","actions":{"Create_a_Task_to_begin_an_AMCP":{"runAfter":{"Next_Reminder_Date":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"CreateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"tasks","item/subject":"Create Account Management Client Plan for  ","item/description":"  Please create the Client Plan and complete\n - Business Review\n - Growth Plan\n - Action Plan \n\n","item/scheduledend":"@addDays(utcNow(), 30)","item/ownerid_task@odata.bind":"/systemusers(@{outputs('Get_Account_Owner')?['body/systemuserid']})","item/regardingobjectid_leidos_accountmanagementrecord_task@odata.bind":"/leidos_accountmanagementrecords(@{items('Loop_Thru_open_AMR_and_Create_Reminder_Task')?['leidos_accountmanagementrecordid']})"},"authentication":"@parameters('$authentication')"}},"Get_Account_Owner":{"runAfter":{"Get_Account":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"systemusers","recordId":"@outputs('Get_Account')?['body/_ownerid_value']"},"authentication":"@parameters('$authentication')"}},"Next_Reminder_Date":{"runAfter":{"Get_Account_Owner":["Succeeded"]},"type":"Compose","inputs":"@addDays(outputs('Get_AMR')?['body/leidos_businessreviewreminderdate'],365)","description":"Current Reminder + 365 days"},"Get_AMR":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_accountmanagementrecords","recordId":"@items('Loop_Thru_open_AMR_and_Create_Reminder_Task')?['leidos_accountmanagementrecordid']"},"authentication":"@parameters('$authentication')"},"description":"Get AMR Record to access Data"},"Get_Account":{"runAfter":{"Get_AMR":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"accounts","recordId":"@items('Loop_Thru_open_AMR_and_Create_Reminder_Task')?['_leidos_parentaccount_value']"},"authentication":"@parameters('$authentication')"}},"Update_AMR_record_with_new_Reminder_Date":{"runAfter":{"Next_Reminder_Date":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_accountmanagementrecords","recordId":"@items('Loop_Thru_open_AMR_and_Create_Reminder_Task')?['leidos_accountmanagementrecordid']","item/leidos_businessreviewreminderdate":"@outputs('Next_Reminder_Date')"},"authentication":"@parameters('$authentication')"}}},"runAfter":{"List_Approved_AMR_Records_Due_Last_30_Days":["Succeeded"]},"type":"Foreach"}},"outputs":{}}},"schemaVersion":"1.0.0.0"}