{"properties":{"connectionReferences":{"shared_commondataserviceforapps_1":{"runtimeSource":"embedded","connection":{"connectionReferenceLogicalName":"leidos_ConnLegal"},"api":{"name":"shared_commondataserviceforapps"}},"shared_office365":{"runtimeSource":"embedded","connection":{"connectionReferenceLogicalName":"leidos_ConnOffice365Outlook"},"api":{"name":"shared_office365"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"Legal_Undertaking_Route_to_HIE_Legal":{"type":"OpenApiConnectionWebhook","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"SubscribeWebhookTrigger","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"subscriptionRequest/message":4,"subscriptionRequest/entityname":"leidos_legalundertaking","subscriptionRequest/scope":4,"subscriptionRequest/filteringattributes":"leidos_routetype","subscriptionRequest/filterexpression":"_leidos_project_value ne null and leidos_routetype eq 445260001"},"authentication":"@parameters('$authentication')"}}},"actions":{"Legal_Team_Email_Address":{"runAfter":{"Parse_JSON":["Succeeded"]},"type":"Compose","inputs":"@body('Parse_JSON')?['value']"},"Get__the_Project":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","recordId":"@triggerOutputs()?['body/_leidos_project_value']"},"authentication":"@parameters('$authentication')"}},"Get_the_Project_Owner":{"runAfter":{"Get__the_Project":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"systemusers","recordId":"@outputs('Get__the_Project')?['body/_ownerid_value']"},"authentication":"@parameters('$authentication')"}},"Get_Legal_Team_from_Environmental_Variable":{"runAfter":{},"type":"Workflow","inputs":{"host":{"workflowReferenceName":"c3e4375a-c7cc-ea11-a812-000d3a7fedbe"},"body":{"text":"LegalTeam_emailaddress"}}},"Parse_JSON":{"runAfter":{"Get_Legal_Team_from_Environmental_Variable":["Succeeded"]},"type":"ParseJson","inputs":{"content":"@outputs('Get_Legal_Team_from_Environmental_Variable')?['Body']?['value']","schema":{"type":"object","properties":{"@@odata.type":{"type":"string"},"@@odata.id":{"type":"string"},"@@odata.etag":{"type":"string"},"@@odata.editLink":{"type":"string"},"value":{"type":"string"},"environmentvariablevalueid@odata.type":{"type":"string"},"environmentvariablevalueid":{"type":"string"}}}}},"Send_email_with_options":{"runAfter":{"Legal_Team_Email_Address":["Succeeded"],"Run_a_Child_Flow":["Succeeded"]},"type":"OpenApiConnectionWebhook","inputs":{"host":{"connectionName":"shared_office365","operationId":"SendMailWithOptions","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"optionsEmailSubscription/Message/To":"@outputs('Legal_Team_Email_Address')","optionsEmailSubscription/Message/Subject":"Legal Input is required for @{outputs('Get__the_Project')?['body/leidos_name']}","optionsEmailSubscription/Message/Options":"Accept Legal Undertaking, Defer","optionsEmailSubscription/Message/HeaderText":"A Legal  Undertaking for @{outputs('Get__the_Project')?['body/leidos_name']} has been assigned","optionsEmailSubscription/Message/SelectionText":"A request for the preparation of Legal Documentaion has been generated.","optionsEmailSubscription/Message/Body":" Project Title : @{outputs('Get__the_Project')?['body/leidos_name']} <br>\n Project Reference: @{outputs('Get__the_Project')?['body/leidos_projectreference']}<br>\n Project Office Name: @{outputs('Get_the_Project_Owner')?['body/fullname']}<br><br><br>\n\nRecord Link: @{concat('<a href=',outputs('Run_a_Child_Flow')?['Body']?['entityurl'],'>Legal Undertaking Link<a/>')}\n","optionsEmailSubscription/Message/Importance":"Normal","optionsEmailSubscription/Message/UseOnlyHTMLMessage":true,"optionsEmailSubscription/Message/HideHTMLMessage":true,"optionsEmailSubscription/Message/ShowHTMLConfirmationDialog":false},"authentication":"@parameters('$authentication')"}},"Condition":{"actions":{"Update_Legal_Undertaking":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_legalundertakings","recordId":"@triggerOutputs()?['body/leidos_legalundertakingid']","item/leidos_acceptedbylegal":"@utcNow()","item/statuscode":445260001},"authentication":"@parameters('$authentication')"}},"Create_Response_task":{"runAfter":{"Update_Legal_Undertaking":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"CreateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"tasks","item/subject":"Legal Undertaking Accepted by HIE Legal","item/description":"Legal Undertaking Accepted by HIE Legal","item/regardingobjectid_leidos_legalundertaking_task@odata.bind":"leidos_legalundertakings(@{triggerOutputs()?['body/leidos_legalundertakingid']})"},"authentication":"@parameters('$authentication')"}}},"runAfter":{"Send_email_with_options":["Succeeded"]},"else":{"actions":{"Send_an_email_(V2)":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@outputs('Get_the_Project_Owner')?['body/internalemailaddress']","emailMessage/Subject":"Legal has defered your request","emailMessage/Body":"<p>Legal has defered your request for input on @{triggerOutputs()?['body/leidos_legalundertakingsreference']}</p>"},"authentication":"@parameters('$authentication')"}}}},"expression":{"equals":["@outputs('Send_email_with_options')?['body/SelectedOption']","Accept Legal Undertaking"]},"type":"If"},"Update_Legal_Undertaking_with_sent_to_Legal":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_legalundertakings","recordId":"@triggerOutputs()?['body/leidos_legalundertakingid']","item/leidos_datesenttolegal":"@utcNow()","item/statuscode":445260000},"authentication":"@parameters('$authentication')"}},"Run_a_Child_Flow":{"runAfter":{"Get_the_Project_Owner":["Succeeded"]},"type":"Workflow","inputs":{"host":{"workflowReferenceName":"b0db1a8a-c449-ea11-a812-000d3a0ba151"},"body":{"EntityId_Inputs":"@triggerOutputs()?['body/leidos_legalundertakingid']","EntityType_Value":"leidos_legalundertaking"}}}},"outputs":{}}},"schemaVersion":"1.0.0.0"}