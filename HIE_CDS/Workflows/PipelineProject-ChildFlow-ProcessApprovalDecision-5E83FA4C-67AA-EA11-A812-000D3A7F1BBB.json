{"properties":{"connectionReferences":{"shared_commondataserviceforapps":{"runtimeSource":"embedded","connection":{},"api":{"name":"shared_commondataserviceforapps"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"manual":{"type":"Request","kind":"PowerApp","inputs":{"schema":{"type":"object","properties":{"ApprovalOutcome_Inputs":{"type":"any","description":"Inputs","x-ms-powerflows-param-ispartial":false},"PipelineID_Inputs":{"type":"any","description":"Inputs","x-ms-powerflows-param-ispartial":false}},"required":["ApprovalOutcome_Inputs","PipelineID_Inputs"]}}}},"actions":{"Approval_Outcome":{"runAfter":{},"type":"Compose","inputs":"@triggerBody()['ApprovalOutcome_Inputs']"},"Respond_to_a_PowerApp_or_flow":{"runAfter":{"Switch":["Succeeded","Failed"]},"type":"Response","kind":"PowerApp","inputs":{"statusCode":200,"body":{},"schema":{"type":"object","properties":{}}}},"PipelineID":{"runAfter":{"Approval_Outcome":["Succeeded"]},"type":"Compose","inputs":"@triggerBody()['PipelineID_Inputs']"},"Pipeline_Project":{"runAfter":{"PipelineID":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_pipelineprojects","recordId":"@outputs('PipelineID')"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"List_Projects":{"runAfter":{"BPF_Pipeline_ID":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","fetchXml":"<fetch distinct=\"true\" >\n  <entity name=\"leidos_project\" >\n    <filter>\n      <condition attribute=\"leidos_preapplicationprocess\" operator=\"eq\" value=\"@{outputs('Pipeline_Project')?['body/leidos_pipelineprojectid']}\" />\n    </filter>\n  </entity>\n</fetch>"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Count_of_Projects":{"runAfter":{"List_Projects":["Succeeded"]},"type":"Compose","inputs":"@length(outputs('List_Projects')?['body/value'])"},"Switch":{"runAfter":{"Count_of_Projects":["Succeeded"]},"cases":{"Invite_to_Apply":{"case":"Invite to Apply","actions":{"Set_Pipeline_to_Approved":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_pipelineprojects","recordId":"@outputs('Pipeline_Project')?['body/leidos_pipelineprojectid']","item/leidos_isaapprovedon":"@utcNow()","item/leidos_isadecisionoutcome":445260000,"item/statecode":1,"item/statuscode":2},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Set_BPF_Pipeline_to_closed":{"runAfter":{"Set_Pipeline_to_Approved":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_bpf_pipelineprojects","recordId":"@outputs('BPF_Pipeline_ID')","item/statecode":1,"item/statuscode":2},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}}},"Do_not_invite_to_Apply":{"case":"Do not invite to Apply","actions":{"Set_Pipeline_to_Do_not_Proceeed":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_pipelineprojects","recordId":"@outputs('Pipeline_Project')?['body/leidos_pipelineprojectid']","item/leidos_isadecisionoutcome":445260001,"item/statecode":1,"item/statuscode":445260001},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Set_BPF_Pipeline_to_closed_for_reject":{"runAfter":{"Set_Pipeline_to_Do_not_Proceeed":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_bpf_pipelineprojects","recordId":"@outputs('BPF_Pipeline_ID')","item/statecode":1,"item/statuscode":2},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}}},"Defer":{"case":"Defer","actions":{"Defer_Pipeline_":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_pipelineprojects","recordId":"@outputs('Pipeline_Project')?['body/leidos_pipelineprojectid']","item/leidos_generateemailsubmission":false,"item/leidos_isadecisionoutcome":445260002,"item/statecode":0,"item/statuscode":1,"item/leidos_submitisa":false},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}}}},"default":{"actions":{}},"expression":"@outputs('Approval_Outcome')","type":"Switch"},"List_BPF_Pipeline":{"runAfter":{"Pipeline_Project":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_bpf_pipelineprojects","$filter":"_bpf_leidos_pipelineprojectid_value eq '@{outputs('Pipeline_Project')?['body/leidos_pipelineprojectid']}'","$top":1},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"BPF_Pipeline_ID":{"runAfter":{"List_BPF_Pipeline":["Succeeded"]},"type":"Compose","inputs":"@outputs('List_BPF_Pipeline')?['body/value']?[0]?.businessprocessflowinstanceid"}},"outputs":{}}},"schemaVersion":"1.0.0.0"}