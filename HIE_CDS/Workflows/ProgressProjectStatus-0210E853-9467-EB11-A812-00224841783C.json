{"properties":{"connectionReferences":{"shared_commondataservice":{"runtimeSource":"invoker","connection":{"connectionReferenceLogicalName":"leidos_sharedcommondataservice_55fe7"},"api":{"name":"shared_commondataservice"}},"shared_commondataserviceforapps_1":{"runtimeSource":"embedded","connection":{"connectionReferenceLogicalName":"leidos_ConnProject"},"api":{"name":"shared_commondataserviceforapps"}},"shared_office365_1":{"runtimeSource":"invoker","connection":{"connectionReferenceLogicalName":"leidos_ConnOutlook2"},"api":{"name":"shared_office365"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"manual":{"splitOn":"@triggerBody()['rows']","type":"Request","kind":"ApiConnection","inputs":{"schema":{"type":"object","properties":{},"required":[]},"host":{"connection":{"name":"@parameters('$connections')['shared_commondataservice']['connectionId']"}},"operationId":"GetOnNewItems_V2","parameters":{"dataset":"default.cds","table":"leidos_projects"}}}},"actions":{"Initialize_Owner_Email_variable":{"runAfter":{},"type":"InitializeVariable","inputs":{"variables":[{"name":"Owner Email","type":"string"}]}},"Scope_-_Get_Data":{"actions":{"Get_Owner_Details":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"systemusers","recordId":"@triggerBody()?['entity']?['_ownerid_value']"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Set_Owner_Email_variable":{"runAfter":{"Get_Owner_Details":["Succeeded"]},"type":"SetVariable","inputs":{"name":"Owner Email","value":"@outputs('Get_Owner_Details')?['body/internalemailaddress']"}},"Get_Project_Data":{"runAfter":{"Set_Owner_Email_variable":["Succeeded"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","recordId":"@triggerBody()?['entity']?['leidos_projectid']"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}},"runAfter":{"Initialize_Owner_Email_variable":["Succeeded"]},"type":"Scope"},"Switch_Current_Project_Status_Reason":{"runAfter":{"Scope_-_Get_Data":["Succeeded"]},"cases":{"Case_Clear_to_Pay_to_Claims_Complete":{"case":445260013,"actions":{"Update_Project_to_Claims_Complete":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","recordId":"@triggerBody()?['entity']?['leidos_projectid']","item/statecode":0,"item/statuscode":445260002},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Send_an_email_(V2)":{"runAfter":{"Update_Project_to_Claims_Complete":["Failed"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365_1","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@variables('Owner Email')","emailMessage/Subject":"Project Status Change Failure","emailMessage/Body":"<p>Project: @{triggerBody()?['entity']?['leidos_projectreference']} &nbsp;@{triggerBody()?['entity']?['leidos_name']}<br>\n<br>\nProject failed to update to status <strong>Claims Complete<br>\n<br>\n</strong>Review required data has been entered before moving to Claims Complete</p>"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}}},"Case_Claims_Complete_to_Project_Complete":{"case":445260002,"actions":{"Update_Project_to_Project_Complete":{"runAfter":{},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps_1","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","recordId":"@triggerBody()?['entity']?['leidos_projectid']","item/statecode":1,"item/statuscode":2},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Send_an_email_(V2)_2":{"runAfter":{"Update_Project_to_Project_Complete":["Failed"]},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_office365_1","operationId":"SendEmailV2","apiId":"/providers/Microsoft.PowerApps/apis/shared_office365"},"parameters":{"emailMessage/To":"@variables('Owner Email')","emailMessage/Subject":"Project Status Change Failure","emailMessage/Body":"<p><strong>Project: </strong><strong>@{triggerBody()?['entity']?['leidos_projectreference']}</strong><strong> &nbsp;</strong><strong>@{triggerBody()?['entity']?['leidos_name']}</strong><strong></strong><br>\n<br>\nProject failed to update to status <strong>Project Complete<br>\n<br>\n</strong>Review Actuals have been entered.<strong><br>\n<br>\n</strong></p>"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}}}},"default":{"actions":{"Terminate":{"runAfter":{},"type":"Terminate","inputs":{"runStatus":"Cancelled"}}}},"expression":"@outputs('Get_Project_Data')?['body/statuscode']","type":"Switch"}},"outputs":{}}},"schemaVersion":"1.0.0.0"}