{"properties":{"connectionReferences":{"shared_commondataserviceforapps":{"runtimeSource":"embedded","connection":{"connectionReferenceLogicalName":"leidos_sharedcommondataserviceforapps_5ec64"},"api":{"name":"shared_commondataserviceforapps"}}},"definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"Project_Status_Reason_is_CTP":{"metadata":{"operationMetadataId":"36f15118-2d53-4a46-9cc1-6ab5b066624a"},"type":"OpenApiConnectionWebhook","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"SubscribeWebhookTrigger","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"subscriptionRequest/message":3,"subscriptionRequest/entityname":"leidos_project","subscriptionRequest/scope":4,"subscriptionRequest/filteringattributes":"statuscode","subscriptionRequest/filterexpression":"statuscode eq 445260013"},"authentication":"@parameters('$authentication')"}}},"actions":{"Get_Project":{"runAfter":{},"metadata":{"operationMetadataId":"e0a78272-b1d6-42b5-b29f-5386aa7a1b7f"},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"GetItem","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projects","recordId":"@triggerOutputs()?['body/leidos_projectid']"},"authentication":"@parameters('$authentication')"}},"Get_Project_Funding":{"runAfter":{"Get_Project":["Succeeded"]},"metadata":{"operationMetadataId":"1fccce4c-2f6d-481c-a438-196df90a3bbf"},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_projectfundings","$select":"leidos_projectfundingid","fetchXml":"<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\">\n  <entity name=\"leidos_projectfunding\">\n    <attribute name=\"leidos_name\" />\n    <attribute name=\"leidos_projectfundingreference\" />\n    <attribute name=\"leidos_projectfundingid\" />\n    <order attribute=\"leidos_name\" descending=\"false\" />\n    <filter type=\"and\">\n      <condition attribute=\"statuscode\" operator=\"ne\" value=\"2\" />\n      <condition attribute=\"leidos_previousfunding\" operator=\"not-null\" />\n      <condition attribute=\"leidos_parentproject\" operator=\"eq\" value =\"@{outputs('Get_Project')?['body/leidos_projectid']}\" />\n    </filter>\n    <link-entity name=\"leidos_projectfunding\" from=\"leidos_projectfundingid\" to=\"leidos_previousfunding\" visible=\"false\" link-type=\"outer\" alias=\"prev\">\n      <attribute name=\"leidos_projectfundingreference\" alias=\"prevfundingref\" />\n    </link-entity>\n  </entity>\n</fetch>"},"authentication":"@parameters('$authentication')"}},"Apply_to_each":{"foreach":"@outputs('Get_Project_Funding')?['body/value']","actions":{"For_each_Funding_Line":{"foreach":"@items('Apply_to_each')?['leidos_projectfundingid']","actions":{"Get_PaymentClaims":{"runAfter":{},"metadata":{"operationMetadataId":"7387a9b8-4431-4d11-a1f3-8704e682e213"},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"ListRecords","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_paymentclaims","$select":"leidos_paymentclaimid","fetchXml":"<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\">\n  <entity name=\"leidos_paymentclaim\">\n    <attribute name=\"leidos_paymentclaimid\" />\n    <attribute name=\"leidos_paymentclaimreference\" />\n    <attribute name=\"leidos_costfundingline\" />\n    <order attribute=\"leidos_name\" descending=\"false\" />\n    <filter type=\"and\">\n      <condition attribute=\"leidos_parentproject\" operator=\"eq\" value =\"@{items('For_each_Funding_Line')?['leidos_projectfundingid']}\" />\n    </filter>\n  </entity>\n</fetch>"},"authentication":"@parameters('$authentication')"}},"For_each_PaymentClaim":{"foreach":"@outputs('Get_PaymentClaims')?['body/value']","actions":{"Update_a_row":{"runAfter":{},"metadata":{"operationMetadataId":"2735247c-ce61-444a-a918-80d94fbb7b3f"},"type":"OpenApiConnection","inputs":{"host":{"connectionName":"shared_commondataserviceforapps","operationId":"UpdateRecord","apiId":"/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"},"parameters":{"entityName":"leidos_paymentclaims","recordId":"@items('For_each_PaymentClaim')?['leidos_paymentclaimid']"},"authentication":"@parameters('$authentication')"}}},"runAfter":{"Get_PaymentClaims":["Succeeded"]},"metadata":{"operationMetadataId":"6e1bd50d-8dcb-4b0e-ab42-2e11d3ba91ae"},"type":"Foreach"}},"runAfter":{},"metadata":{"operationMetadataId":"f1987113-4949-41c7-972b-68c6b7710a75"},"type":"Foreach"}},"runAfter":{"Get_Project_Funding":["Succeeded"]},"metadata":{"operationMetadataId":"7fe672a5-f68a-4467-b799-f11c549029cf"},"type":"Foreach"}},"outputs":{}}},"schemaVersion":"1.0.0.0"}